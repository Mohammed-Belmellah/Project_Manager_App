<div class="container mt-5">
  
  @if (project) {
    <div class="d-flex justify-content-between align-items-start mb-4">
      <div>
        <a routerLink="/projects" class="text-decoration-none">&larr; Back to Projects</a>
        <h2 class="mt-2">{{ project.title }}</h2>
        <p class="text-muted">{{ project.description }}</p>
      </div>
      
      <div class="text-end">
        <h5>
          Progress 
          <span class="text-muted fs-6">
            ({{ project.completedTasks }} / {{ project.totalTasks }})
          </span>
        </h5>

        <div class="progress" style="width: 200px; height: 20px;">
          <div class="progress-bar bg-success" 
               role="progressbar" 
               [style.width.%]="project.progressPercentage">
               {{ project.progressPercentage | number:'1.0-0' }}%
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3 mt-5">
      <div class="d-flex align-items-center gap-2">
        <h4 class="mb-0">Tasks</h4>
        <span class="badge bg-secondary rounded-pill">
          {{ project.totalTasks }}
        </span>
      </div>
      
      @if (!showTaskForm) {
        <button class="btn btn-success" (click)="showTaskForm = true">
          + Add New Task
        </button>
      }
    </div>

    @if (showTaskForm) {
      <div class="card mb-4 shadow-sm border-success">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0">New Task Details</h5>
          <button type="button" class="btn-close" aria-label="Close" (click)="showTaskForm = false"></button>
        </div>
        
        <div class="card-body">
          <form (ngSubmit)="addTask()">
            <div class="row g-3">
              
              <div class="col-md-6">
                <label class="form-label small text-muted">Task Title</label>
                <input type="text" class="form-control" placeholder="E.g. Fix Login Bug" 
                       [(ngModel)]="newTaskTitle" name="title" required>
              </div>

              <div class="col-md-6">
                <label class="form-label small text-muted">Due Date</label>
                <input type="date" class="form-control" 
                       [(ngModel)]="newTaskDueDate" name="dueDate" required>
              </div>

              <div class="col-12">
                <label class="form-label small text-muted">Description</label>
                <textarea class="form-control" placeholder="Enter task details..." 
                          [(ngModel)]="newTaskDescription" name="description" rows="2"></textarea>
              </div>
              <div class="col-12 d-flex align-items-center justify-content-between mt-3">
                <div class="d-flex gap-2">
                  <button type="button" class="btn btn-outline-secondary" (click)="showTaskForm = false">
                    Cancel
                  </button>
                  <button type="submit" class="btn btn-primary px-4">Create Task</button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    }

    <ul class="list-group shadow-sm mt-4">
      @for (task of tasks; track task.id) {
        <li class="list-group-item d-flex justify-content-between align-items-center">
          
          <div class="d-flex align-items-center gap-3">
            <div 
              class="rounded-circle border d-flex align-items-center justify-content-center"
              style="width: 24px; height: 24px; cursor: pointer;"
              [class.bg-success]="task.completed"
              [class.border-success]="task.completed"
              (click)="toggleTaskStatus(task)">
              @if (task.completed) {
                <span class="text-white small">&#10003;</span>
              }
            </div>

            <div>
              <strong [style.text-decoration]="task.completed ? 'line-through' : 'none'" 
                      [class.text-muted]="task.completed">
                {{ task.title }}
              </strong>
              <br>
              <small class="text-muted">Due: {{ task.dueDate }}</small>
              @if (task.description) {
                <p class="mb-0 mt-1 text-secondary small" style="white-space: pre-wrap;">
                  {{ task.description }}
                </p>
              }
            </div>
          </div>

          <div class="btn-group">
            <button 
              class="btn btn-sm" 
              [class.btn-outline-success]="!task.completed"
              [class.btn-outline-warning]="task.completed"
              (click)="toggleTaskStatus(task)">
              {{ task.completed ? 'Undo' : 'Done' }}
            </button>
            
            <button class="btn btn-sm btn-outline-danger" (click)="deleteTask(task.id)">
              Delete
            </button>
          </div>

        </li>
      } 
      
      @empty {
        <li class="list-group-item text-center text-muted p-4">
          No tasks yet. Add one above!
        </li>
      }
    </ul>
  } @else {
    <p>Loading project...</p>
  }
</div>